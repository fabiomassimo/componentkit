(window.webpackJsonp=window.webpackJsonp||[]).push([[16],{69:function(e,a,n){"use strict";n.r(a),n.d(a,"frontMatter",function(){return p}),n.d(a,"rightToc",function(){return r}),n.d(a,"default",function(){return i});n(0);var t=n(133),o=(n(134),n(138));function c(){return(c=Object.assign||function(e){for(var a=1;a<arguments.length;a++){var n=arguments[a];for(var t in n)Object.prototype.hasOwnProperty.call(n,t)&&(e[t]=n[t])}return e}).apply(this,arguments)}function s(e,a){if(null==e)return{};var n,t,o=function(e,a){if(null==e)return{};var n,t,o={},c=Object.keys(e);for(t=0;t<c.length;t++)n=c[t],a.indexOf(n)>=0||(o[n]=e[n]);return o}(e,a);if(Object.getOwnPropertySymbols){var c=Object.getOwnPropertySymbols(e);for(t=0;t<c.length;t++)n=c[t],a.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(o[n]=e[n])}return o}var p={title:"Component Controllers"},r=[{value:"Creating Controllers",id:"creating-controllers",children:[]},{value:"Controller Flow",id:"controller-flow",children:[]},{value:"Communication between Component and Component Controller",id:"communication-between-component-and-component-controller",children:[]}],m={rightToc:r},l="wrapper";function i(e){var a=e.components,n=s(e,["components"]);return Object(t.a)(l,c({},m,n,{components:a,mdxType:"MDXLayout"}),Object(t.a)("p",null,"Remember the analogy made in ",Object(t.a)("a",c({parentName:"p"},{href:"philosophy.html"}),"Philosophy"),": components are like a stencil. They are an immutable snapshot of how a view should be configured at a given moment in time."),Object(t.a)("p",null,"Every time something changes, an entirely new component is created and the old one is thrown away. This means components are ",Object(t.a)("strong",{parentName:"p"},"short-lived"),", and their lifecycle is not under your control."),Object(t.a)("p",null,"But sometimes, you do need an object with a longer lifecycle. ",Object(t.a)("em",{parentName:"p"},"Component controllers")," fill that role:"),Object(t.a)("ul",null,Object(t.a)("li",{parentName:"ul"},Object(t.a)("a",c({parentName:"li"},{href:"components-cant-be-delegates.html"}),"Components can't be delegates")," because they are short-lived, but component controllers can be delegates."),Object(t.a)("li",{parentName:"ul"},"Network downloads take time to complete; the component may have been recreated by the time the download completes. The controller can handle the callback."),Object(t.a)("li",{parentName:"ul"},"You may need an object to own some other object that should have a long lifetime.")),Object(t.a)("h2",null,Object(t.a)("a",c({parentName:"h2"},{"aria-hidden":!0,className:"anchor",id:"creating-controllers"})),Object(t.a)("a",c({parentName:"h2"},{"aria-hidden":!0,className:"hash-link",href:"#creating-controllers"}),"#"),"Creating Controllers"),Object(t.a)("ul",null,Object(t.a)("li",{parentName:"ul"},"Controllers are instantiated automatically by ComponentKit. Don't try to create them manually."),Object(t.a)("li",{parentName:"ul"},"Define a controller by simply creating a subclass of ",Object(t.a)("inlineCode",{parentName:"li"},"CKComponentController"),'; the naming convention is your component name plus "Controller". However, you can choose a different name or reuse an existing controller.'),Object(t.a)("li",{parentName:"ul"},"Your component must have a ",Object(t.a)("a",{href:"scopes.html"},Object(t.a)("inlineCode",{parentName:"li"},"CKComponentScope"))," to have a controller. (If you forget, you will get an assertion failure.)"),Object(t.a)("li",{parentName:"ul"},"Your component must override ",Object(t.a)("inlineCode",{parentName:"li"},"+ (Class<CKComponentControllerProtocol>)controllerClass")," to indicate which class is its controller."),Object(t.a)("li",{parentName:"ul"},"Any ",Object(t.a)("inlineCode",{parentName:"li"},"CKComponentAction")," methods handled by your component can also be handled by the controller.")),Object(t.a)("h2",null,Object(t.a)("a",c({parentName:"h2"},{"aria-hidden":!0,className:"anchor",id:"controller-flow"})),Object(t.a)("a",c({parentName:"h2"},{"aria-hidden":!0,className:"hash-link",href:"#controller-flow"}),"#"),"Controller Flow"),Object(t.a)(o.a,{src:"assets/component-controllers.png",alt:"Component Controller Flow",width:"338",height:"242",mdxType:"Image"}),Object(t.a)("ol",null,Object(t.a)("li",{parentName:"ol"},"The component controller is ",Object(t.a)("strong",{parentName:"li"},"created")," with the first component."),Object(t.a)("li",{parentName:"ol"},"When the component is updated, a new instance is generatedâ€¦"),Object(t.a)("li",{parentName:"ol"},"But the component controller stays the same.")),Object(t.a)("h2",null,Object(t.a)("a",c({parentName:"h2"},{"aria-hidden":!0,className:"anchor",id:"communication-between-component-and-component-controller"})),Object(t.a)("a",c({parentName:"h2"},{"aria-hidden":!0,className:"hash-link",href:"#communication-between-component-and-component-controller"}),"#"),"Communication between Component and Component Controller"),Object(t.a)("p",null,"There is a only a one-way communication channel between the component and its component controller - you can only pass data off of a component to a component controller. A component has no reference its corresponding component controller. This is by design."),Object(t.a)("p",null,"To pass data from a component to its controller, expose a ",Object(t.a)("inlineCode",{parentName:"p"},"@property")," on the component in a class extension. The controller can initialize itself with the properties in ",Object(t.a)("inlineCode",{parentName:"p"},"initWithComponent:"),". If these properties will be changing in subsequent state changes (i.e. a new component is being created with different values for these properties), keep them up to date in ",Object(t.a)("inlineCode",{parentName:"p"},"didUpdateComponent"),"."),Object(t.a)("pre",{className:"language-objectivec"},Object(t.a)("code",c({parentName:"pre"},{className:"language-objectivec",metastring:"highlight",highlight:!0}),Object(t.a)("span",c({parentName:"code"},{className:"token keyword"}),"@interface")," ",Object(t.a)("span",c({parentName:"code"},{className:"token function"}),"MySongComponent"),Object(t.a)("span",c({parentName:"code"},{className:"token punctuation"}),"("),Object(t.a)("span",c({parentName:"code"},{className:"token punctuation"}),")"),"\n",Object(t.a)("span",c({parentName:"code"},{className:"token keyword"}),"@property")," ",Object(t.a)("span",c({parentName:"code"},{className:"token punctuation"}),"("),"nonatomic",Object(t.a)("span",c({parentName:"code"},{className:"token punctuation"}),",")," strong",Object(t.a)("span",c({parentName:"code"},{className:"token punctuation"}),",")," readonly",Object(t.a)("span",c({parentName:"code"},{className:"token punctuation"}),")")," MySong ",Object(t.a)("span",c({parentName:"code"},{className:"token operator"}),"*"),"song",Object(t.a)("span",c({parentName:"code"},{className:"token punctuation"}),";"),"     ",Object(t.a)("span",c({parentName:"code"},{className:"token comment"}),"// All components for a controller share the same value"),"\n",Object(t.a)("span",c({parentName:"code"},{className:"token keyword"}),"@property")," ",Object(t.a)("span",c({parentName:"code"},{className:"token punctuation"}),"("),"nonatomic",Object(t.a)("span",c({parentName:"code"},{className:"token punctuation"}),",")," assign",Object(t.a)("span",c({parentName:"code"},{className:"token punctuation"}),",")," readonly",Object(t.a)("span",c({parentName:"code"},{className:"token punctuation"}),")")," BOOL isPlaying",Object(t.a)("span",c({parentName:"code"},{className:"token punctuation"}),";"),"   ",Object(t.a)("span",c({parentName:"code"},{className:"token comment"}),"// Different components may have different values (part of component state)"),"\n",Object(t.a)("span",c({parentName:"code"},{className:"token keyword"}),"@end"),"\n\n",Object(t.a)("span",c({parentName:"code"},{className:"token comment"}),"// In order to provide the component controller class in the `+ (Class<CKComponentControllerProtocol>)controllerClass`"),"\n",Object(t.a)("span",c({parentName:"code"},{className:"token comment"}),"// method, we have to declare the controller before the component's implementation."),"\n",Object(t.a)("span",c({parentName:"code"},{className:"token keyword"}),"@interface")," MySongComponentController ",Object(t.a)("span",c({parentName:"code"},{className:"token punctuation"}),":")," CKComponentController\n",Object(t.a)("span",c({parentName:"code"},{className:"token keyword"}),"@end"),"\n\n",Object(t.a)("span",c({parentName:"code"},{className:"token keyword"}),"@implementation")," MySongComponent ",Object(t.a)("span",c({parentName:"code"},{className:"token punctuation"}),":")," CKCompositeComponent\n",Object(t.a)("span",c({parentName:"code"},{className:"token operator"}),"+")," ",Object(t.a)("span",c({parentName:"code"},{className:"token punctuation"}),"("),"instancetype",Object(t.a)("span",c({parentName:"code"},{className:"token punctuation"}),")"),"newWithSong",Object(t.a)("span",c({parentName:"code"},{className:"token punctuation"}),":"),Object(t.a)("span",c({parentName:"code"},{className:"token punctuation"}),"("),"MySong ",Object(t.a)("span",c({parentName:"code"},{className:"token operator"}),"*"),Object(t.a)("span",c({parentName:"code"},{className:"token punctuation"}),")"),"song\n",Object(t.a)("span",c({parentName:"code"},{className:"token punctuation"}),"{"),"\n  CKComponentScope ",Object(t.a)("span",c({parentName:"code"},{className:"token function"}),"scope"),Object(t.a)("span",c({parentName:"code"},{className:"token punctuation"}),"("),Object(t.a)("span",c({parentName:"code"},{className:"token keyword"}),"self"),Object(t.a)("span",c({parentName:"code"},{className:"token punctuation"}),",")," song",Object(t.a)("span",c({parentName:"code"},{className:"token punctuation"}),"."),"unique_id",Object(t.a)("span",c({parentName:"code"},{className:"token punctuation"}),")"),Object(t.a)("span",c({parentName:"code"},{className:"token punctuation"}),";"),"\n  ",Object(t.a)("span",c({parentName:"code"},{className:"token keyword"}),"const")," BOOL isPlaying ",Object(t.a)("span",c({parentName:"code"},{className:"token operator"}),"=")," ",Object(t.a)("span",c({parentName:"code"},{className:"token punctuation"}),"["),"scope",Object(t.a)("span",c({parentName:"code"},{className:"token punctuation"}),"."),Object(t.a)("span",c({parentName:"code"},{className:"token function"}),"state"),Object(t.a)("span",c({parentName:"code"},{className:"token punctuation"}),"("),Object(t.a)("span",c({parentName:"code"},{className:"token punctuation"}),")")," boolValue",Object(t.a)("span",c({parentName:"code"},{className:"token punctuation"}),"]"),Object(t.a)("span",c({parentName:"code"},{className:"token punctuation"}),";"),"\n  MySongComponent ",Object(t.a)("span",c({parentName:"code"},{className:"token operator"}),"*"),Object(t.a)("span",c({parentName:"code"},{className:"token keyword"}),"const")," c ",Object(t.a)("span",c({parentName:"code"},{className:"token operator"}),"="),"\n  ",Object(t.a)("span",c({parentName:"code"},{className:"token punctuation"}),"["),"MySongComponent\n   newWithComponent",Object(t.a)("span",c({parentName:"code"},{className:"token punctuation"}),":"),Object(t.a)("span",c({parentName:"code"},{className:"token punctuation"}),"["),"SongUIComponent\n                     newWithIsPlaying",Object(t.a)("span",c({parentName:"code"},{className:"token punctuation"}),":"),"isPlaying",Object(t.a)("span",c({parentName:"code"},{className:"token punctuation"}),"]"),Object(t.a)("span",c({parentName:"code"},{className:"token punctuation"}),"]"),Object(t.a)("span",c({parentName:"code"},{className:"token punctuation"}),";"),"\n  ",Object(t.a)("span",c({parentName:"code"},{className:"token keyword"}),"if")," ",Object(t.a)("span",c({parentName:"code"},{className:"token punctuation"}),"("),"c",Object(t.a)("span",c({parentName:"code"},{className:"token punctuation"}),")")," ",Object(t.a)("span",c({parentName:"code"},{className:"token punctuation"}),"{"),"\n    c",Object(t.a)("span",c({parentName:"code"},{className:"token operator"}),"->"),"_song ",Object(t.a)("span",c({parentName:"code"},{className:"token operator"}),"=")," song",Object(t.a)("span",c({parentName:"code"},{className:"token punctuation"}),";"),"\n    c",Object(t.a)("span",c({parentName:"code"},{className:"token operator"}),"->"),"_isPlaying ",Object(t.a)("span",c({parentName:"code"},{className:"token operator"}),"=")," isPlaying",Object(t.a)("span",c({parentName:"code"},{className:"token punctuation"}),";"),"\n  ",Object(t.a)("span",c({parentName:"code"},{className:"token punctuation"}),"}"),"\n  ",Object(t.a)("span",c({parentName:"code"},{className:"token keyword"}),"return")," c",Object(t.a)("span",c({parentName:"code"},{className:"token punctuation"}),";"),"\n",Object(t.a)("span",c({parentName:"code"},{className:"token punctuation"}),"}"),"\n\n",Object(t.a)("span",c({parentName:"code"},{className:"token operator"}),"+")," ",Object(t.a)("span",c({parentName:"code"},{className:"token punctuation"}),"("),"Class",Object(t.a)("span",c({parentName:"code"},{className:"token operator"}),"<"),"CKComponentControllerProtocol",Object(t.a)("span",c({parentName:"code"},{className:"token operator"}),">"),Object(t.a)("span",c({parentName:"code"},{className:"token punctuation"}),")"),"controllerClass\n",Object(t.a)("span",c({parentName:"code"},{className:"token punctuation"}),"{"),"\n  ",Object(t.a)("span",c({parentName:"code"},{className:"token keyword"}),"return")," ",Object(t.a)("span",c({parentName:"code"},{className:"token punctuation"}),"["),"MySongComponentController class",Object(t.a)("span",c({parentName:"code"},{className:"token punctuation"}),"]"),Object(t.a)("span",c({parentName:"code"},{className:"token punctuation"}),";"),"\n",Object(t.a)("span",c({parentName:"code"},{className:"token punctuation"}),"}"),"\n",Object(t.a)("span",c({parentName:"code"},{className:"token keyword"}),"@end"),"\n\n",Object(t.a)("span",c({parentName:"code"},{className:"token keyword"}),"@implementation")," MySongComponentController\n",Object(t.a)("span",c({parentName:"code"},{className:"token punctuation"}),"{"),"\n  MySong ",Object(t.a)("span",c({parentName:"code"},{className:"token operator"}),"*"),"_song",Object(t.a)("span",c({parentName:"code"},{className:"token punctuation"}),";"),"\n",Object(t.a)("span",c({parentName:"code"},{className:"token punctuation"}),"}"),"\n\n",Object(t.a)("span",c({parentName:"code"},{className:"token operator"}),"-")," ",Object(t.a)("span",c({parentName:"code"},{className:"token punctuation"}),"("),"instancetype",Object(t.a)("span",c({parentName:"code"},{className:"token punctuation"}),")"),"initWithComponent",Object(t.a)("span",c({parentName:"code"},{className:"token punctuation"}),":"),Object(t.a)("span",c({parentName:"code"},{className:"token punctuation"}),"("),"MySongComponent ",Object(t.a)("span",c({parentName:"code"},{className:"token operator"}),"*"),Object(t.a)("span",c({parentName:"code"},{className:"token punctuation"}),")"),"component\n",Object(t.a)("span",c({parentName:"code"},{className:"token punctuation"}),"{"),"\n  ",Object(t.a)("span",c({parentName:"code"},{className:"token keyword"}),"if")," ",Object(t.a)("span",c({parentName:"code"},{className:"token punctuation"}),"("),Object(t.a)("span",c({parentName:"code"},{className:"token keyword"}),"self")," ",Object(t.a)("span",c({parentName:"code"},{className:"token operator"}),"=")," ",Object(t.a)("span",c({parentName:"code"},{className:"token punctuation"}),"["),Object(t.a)("span",c({parentName:"code"},{className:"token keyword"}),"super")," initWithComponent",Object(t.a)("span",c({parentName:"code"},{className:"token punctuation"}),":"),"component",Object(t.a)("span",c({parentName:"code"},{className:"token punctuation"}),"]"),Object(t.a)("span",c({parentName:"code"},{className:"token punctuation"}),")")," ",Object(t.a)("span",c({parentName:"code"},{className:"token punctuation"}),"{"),"\n    _song ",Object(t.a)("span",c({parentName:"code"},{className:"token operator"}),"=")," component",Object(t.a)("span",c({parentName:"code"},{className:"token punctuation"}),"."),"song",Object(t.a)("span",c({parentName:"code"},{className:"token punctuation"}),";"),"\n    ",Object(t.a)("span",c({parentName:"code"},{className:"token punctuation"}),"["),"_song",Object(t.a)("span",c({parentName:"code"},{className:"token punctuation"}),"."),"setDelegate",Object(t.a)("span",c({parentName:"code"},{className:"token punctuation"}),":"),Object(t.a)("span",c({parentName:"code"},{className:"token keyword"}),"self"),Object(t.a)("span",c({parentName:"code"},{className:"token punctuation"}),"]"),Object(t.a)("span",c({parentName:"code"},{className:"token punctuation"}),";"),"\n  ",Object(t.a)("span",c({parentName:"code"},{className:"token punctuation"}),"}"),"\n  ",Object(t.a)("span",c({parentName:"code"},{className:"token keyword"}),"return")," ",Object(t.a)("span",c({parentName:"code"},{className:"token keyword"}),"self"),Object(t.a)("span",c({parentName:"code"},{className:"token punctuation"}),";"),"\n",Object(t.a)("span",c({parentName:"code"},{className:"token punctuation"}),"}"),"\n\n",Object(t.a)("span",c({parentName:"code"},{className:"token operator"}),"-")," ",Object(t.a)("span",c({parentName:"code"},{className:"token punctuation"}),"("),Object(t.a)("span",c({parentName:"code"},{className:"token keyword"}),"void"),Object(t.a)("span",c({parentName:"code"},{className:"token punctuation"}),")"),"songStateDidChange",Object(t.a)("span",c({parentName:"code"},{className:"token punctuation"}),":"),Object(t.a)("span",c({parentName:"code"},{className:"token punctuation"}),"("),"BOOL",Object(t.a)("span",c({parentName:"code"},{className:"token punctuation"}),")"),"isPlaying\n",Object(t.a)("span",c({parentName:"code"},{className:"token punctuation"}),"{"),"\n  ",Object(t.a)("span",c({parentName:"code"},{className:"token punctuation"}),"["),Object(t.a)("span",c({parentName:"code"},{className:"token keyword"}),"self"),Object(t.a)("span",c({parentName:"code"},{className:"token punctuation"}),"."),"component updateState",Object(t.a)("span",c({parentName:"code"},{className:"token punctuation"}),":"),Object(t.a)("span",c({parentName:"code"},{className:"token operator"}),"^"),Object(t.a)("span",c({parentName:"code"},{className:"token punctuation"}),"{"),"\n    ",Object(t.a)("span",c({parentName:"code"},{className:"token keyword"}),"return")," ",Object(t.a)("span",c({parentName:"code"},{className:"token operator"}),"@"),Object(t.a)("span",c({parentName:"code"},{className:"token punctuation"}),"("),"isPlaying",Object(t.a)("span",c({parentName:"code"},{className:"token punctuation"}),")"),Object(t.a)("span",c({parentName:"code"},{className:"token punctuation"}),";"),"\n  ",Object(t.a)("span",c({parentName:"code"},{className:"token punctuation"}),"}")," mode",Object(t.a)("span",c({parentName:"code"},{className:"token punctuation"}),":"),"CKUpdateModeAsynchronous",Object(t.a)("span",c({parentName:"code"},{className:"token punctuation"}),"]"),Object(t.a)("span",c({parentName:"code"},{className:"token punctuation"}),";"),"\n",Object(t.a)("span",c({parentName:"code"},{className:"token punctuation"}),"}"),"\n\n",Object(t.a)("span",c({parentName:"code"},{className:"token operator"}),"-")," ",Object(t.a)("span",c({parentName:"code"},{className:"token punctuation"}),"("),Object(t.a)("span",c({parentName:"code"},{className:"token keyword"}),"void"),Object(t.a)("span",c({parentName:"code"},{className:"token punctuation"}),")"),"didUpdateComponent\n",Object(t.a)("span",c({parentName:"code"},{className:"token punctuation"}),"{"),"\n  ",Object(t.a)("span",c({parentName:"code"},{className:"token comment"}),"// This only fires on a state *change* (i.e. not through the initializer path)."),"\n",Object(t.a)("span",c({parentName:"code"},{className:"token punctuation"}),"}"),"\n",Object(t.a)("span",c({parentName:"code"},{className:"token keyword"}),"@end"),"\n")))}i.isMDXComponent=!0}}]);